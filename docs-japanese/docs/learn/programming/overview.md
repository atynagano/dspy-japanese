---
sidebar_position: 1
---

# DSPyにおけるプログラミング手法

DSPyは_文字列ではなくコードを書く_というコンセプトに基づくプログラミング手法です。言い換えれば、適切な制御フローの設計が極めて重要となります。まず**タスクの定義**から始めましょう。システムへの入力データは何か、そしてシステムが出力すべき結果は何か？ これはデータに基づくチャットボットでしょうか、それともコードアシスタントでしょうか？ あるいは翻訳システム、検索結果からの重要箇所のハイライト機能、あるいは引用付きレポート生成システムといった用途も考えられます。

次に**初期パイプライン**を定義します。DSPyプログラムは単一のモジュールで構成可能か、あるいは複数の段階に分割する必要があるでしょうか？ 検索処理機能や計算機、カレンダーAPIといった追加ツールは必要でしょうか？ 問題を明確なスコープを持つ複数のステップで解決する典型的なワークフローが存在するのか、それともより自由度の高いツール使用とエージェント機能をタスクに取り入れたいのでしょうか？ これらの点を考慮しつつ、最初はシンプルな構成――単一の`dspy.ChainOfThought`モジュール――から始め、観察結果に基づいて段階的に複雑性を追加していくとよいでしょう。

このプロセスを進める中で、**プログラムへの入力例をいくつか作成し実際に試してみる**ことが重要です。現時点では強力な大規模言語モデル（LM）を使用するか、あるいは複数の異なるLMを試してみることをお勧めします。これにより、どのような可能性が開けるかを理解することができるでしょう。試した中で特に興味深い事例――簡単なものから難しいものまで――を記録しておいてください。これらは後段で行う評価や最適化作業において非常に有用な資料となります。


??? "優れた設計パターンの促進以外に、DSPyは具体的にどのような利点をもたらすのか？"

    従来のプロンプト設計では、システムの基本アーキテクチャと、新しいLMや目的、パイプラインに移行する際に移植性のない付随的な選択事項が密接に結びついています。従来のプロンプト設計では、LMに対して特定の形式の入力を与え、特定の種類の出力を生成するよう指示します（これを_シグネチャ_と呼びます）。また、入力を特定の形式でフォーマットし、LMが正確に解析可能な形式で出力を求めるよう指示します（これを_アダプタ_と呼びます）。さらに、「段階的な思考」や「ツールの活用」といった特定の戦略を適用するよう指示します（これは_モジュール_のロジックに相当します）。そして、各LMに対して適切な指示方法を発見するためには、多大な試行錯誤が必要となります（これは一種の手動_最適化_と言えます）。

    DSPyでは、これらの懸念事項を明確に分離し、下位レベルの処理を自動化することで、ユーザーがこれらの問題を考慮する必要がなくなるように設計されています。これにより、はるかに簡潔なコードを記述できるだけでなく、より高い移植性も実現できます。例えば、DSPyモジュールを使用してプログラムを記述した場合、LMを変更したりそのアダプタを変更したりしても、残りのロジックを変更する必要がありません。あるいは、`dspy.ChainOfThought`のような特定の_モジュール_を、`dspy.ProgramOfThought`のような別のモジュールと交換しても、シグネチャを変更する必要はありません。最適化ツールを使用する準備が整った段階で、同じプログラムのプロンプトを最適化したり、LMの重みをファインチューニングしたりすることも可能です。
