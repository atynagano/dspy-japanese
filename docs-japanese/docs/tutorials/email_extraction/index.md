# DSPyã‚’ç”¨ã„ãŸé›»å­ãƒ¡ãƒ¼ãƒ«ã‹ã‚‰ã®æƒ…å ±æŠ½å‡º

æœ¬ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€DSpyã‚’æ´»ç”¨ã—ãŸã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªé›»å­ãƒ¡ãƒ¼ãƒ«å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚æœ¬ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€å„ç¨®é›»å­ãƒ¡ãƒ¼ãƒ«ã‹ã‚‰é‡è¦ãªæƒ…å ±ã‚’è‡ªå‹•æŠ½å‡ºã—ã€ãã®æ„å›³ã‚’åˆ†é¡ã—ã€ã•ã‚‰ã«å¾Œç¶šå‡¦ç†ã«é©ã—ãŸå½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ§‹é€ åŒ–ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## æ§‹ç¯‰ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®æ¦‚è¦

æœ¬ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ä¿®äº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’å‚™ãˆãŸDSpyãƒ™ãƒ¼ã‚¹ã®é›»å­ãƒ¡ãƒ¼ãƒ«å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

- **é›»å­ãƒ¡ãƒ¼ãƒ«ã®ç¨®åˆ¥åˆ†é¡**ï¼ˆæ³¨æ–‡ç¢ºèªãƒ¡ãƒ¼ãƒ«ã€ã‚µãƒãƒ¼ãƒˆä¾é ¼ãƒ¡ãƒ¼ãƒ«ã€ä¼šè­°æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ãªã©ï¼‰
- **ä¸»è¦ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®æŠ½å‡º**ï¼ˆæ—¥ä»˜ã€é‡‘é¡ã€è£½å“åã€é€£çµ¡å…ˆæƒ…å ±ãªã©ï¼‰
- **ç·Šæ€¥åº¦ãƒ¬ãƒ™ãƒ«ã®åˆ¤å®š**ã¨å¿…è¦ãªå¯¾å¿œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ç‰¹å®š
- **æŠ½å‡ºãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ åŒ–**ã«ã‚ˆã‚‹ä¸€è²«ã—ãŸãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¸ã®å¤‰æ›
- **å¤šæ§˜ãªé›»å­ãƒ¡ãƒ¼ãƒ«å½¢å¼ã¸ã®å¯¾å¿œ**ï¼ˆè¤‡æ•°ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå½¢å¼ã‚’å …ç‰¢ã«å‡¦ç†å¯èƒ½ï¼‰

## å‰ææ¡ä»¶

- DSPyãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã‚·ã‚°ãƒãƒãƒ£ã«é–¢ã™ã‚‹åŸºæœ¬çš„ãªçŸ¥è­˜
- Python 3.9ä»¥é™ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ç’°å¢ƒ
- OpenAI APIã‚­ãƒ¼ï¼ˆã¾ãŸã¯ä»–ã®ã‚µãƒãƒ¼ãƒˆå¯¾è±¡LLMã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ï¼‰

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ç’°å¢ƒè¨­å®š

```bash
pip install dspy
```

<details>
<summary>æ¨å¥¨è¨­å®šï¼šMLflow Tracingã‚’æœ‰åŠ¹ã«ã—ã¦ã€å†…éƒ¨å‡¦ç†ã®è©³ç´°ã‚’æŠŠæ¡ã—ã¾ã—ã‚‡ã†</summary>

### MLflowã¨DSPyã®çµ±åˆã«ã¤ã„ã¦

<a href="https://mlflow.org/">MLflow</a>ã¯ã€DSPyã¨ãƒã‚¤ãƒ†ã‚£ãƒ–ã«é€£æºå¯èƒ½ãªLLMOpsãƒ„ãƒ¼ãƒ«ã§ã‚ã‚Šã€èª¬æ˜å¯èƒ½æ€§ã¨å®Ÿé¨“è¿½è·¡æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚æœ¬ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€MLflowã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚„æœ€é©åŒ–ã®é€²æ—ã‚’ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ã—ã¦å¯è¦–åŒ–ã™ã‚‹ã“ã¨ã§ã€DSPyã®å‹•ä½œã‚’ã‚ˆã‚Šè©³ç´°ã«ç†è§£ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®4ã¤ã®ç°¡å˜ãªæ‰‹é †ã«å¾“ã£ã¦ã€MLflowã‚’ç°¡å˜ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¯èƒ½ã§ã™ã€‚

![MLflowãƒˆãƒ¬ãƒ¼ã‚¹ç”»é¢](./mlflow-tracing-email-extraction.png)

1. MLflowã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
%pip install mlflow>=3.0.0
```

2. åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§MLflow UIã‚’èµ·å‹•ã™ã‚‹
```bash
mlflow ui --port 5000 --backend-store-uri sqlite:///mlruns.db
```

3. MLflowã«ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã‚’æ¥ç¶šã™ã‚‹
```python
import mlflow

mlflow.set_tracking_uri("http://localhost:5000")
mlflow.set_experiment("DSPy")
```

4. ãƒˆãƒ¬ãƒ¼ã‚¹æ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–
```python
mlflow.dspy.autolog()
```


çµ±åˆæ©Ÿèƒ½ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€[MLflow DSPyãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://mlflow.org/docs/latest/llms/dspy/index.html)ã‚‚ä½µã›ã¦ã”å‚ç…§ãã ã•ã„ã€‚
</details>

## ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å®šç¾©

ã¾ãšã€ãƒ¡ãƒ¼ãƒ«ã‹ã‚‰æŠ½å‡ºã—ãŸã„æƒ…å ±ã®ç¨®é¡ã‚’æ˜ç¢ºã«å®šç¾©ã—ã¾ã™ï¼š

```python
import dspy
from typing import List, Optional, Literal
from datetime import datetime
from pydantic import BaseModel
from enum import Enum

class EmailType(str, Enum):
    ORDER_CONFIRMATION = "order_confirmation"
    SUPPORT_REQUEST = "support_request"
    MEETING_INVITATION = "meeting_invitation"
    NEWSLETTER = "newsletter"
    PROMOTIONAL = "promotional"
    INVOICE = "invoice"
    SHIPPING_NOTIFICATION = "shipping_notification"
    OTHER = "other"

class UrgencyLevel(str, Enum):
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    CRITICAL = "critical"

class ExtractedEntity(BaseModel):
    entity_type: str
    value: str
    confidence: float
```

## ã‚¹ãƒ†ãƒƒãƒ—2: DSPyã‚·ã‚°ãƒãƒãƒ£ã®ä½œæˆ

æ¬¡ã«ã€ãƒ¡ãƒ¼ãƒ«å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚·ã‚°ãƒãƒãƒ£ã‚’å®šç¾©ã—ã¾ã™ï¼š

```python
class ClassifyEmail(dspy.Signature):
    """ãƒ¡ãƒ¼ãƒ«ã®å†…å®¹ã«åŸºã¥ã„ã¦ã€ãã®ç¨®åˆ¥ã¨ç·Šæ€¥åº¦ã‚’åˆ†é¡ã™ã‚‹ã€‚"""

    email_subject: str = dspy.InputField(desc="ãƒ¡ãƒ¼ãƒ«ã®ä»¶å")
    email_body: str = dspy.InputField(desc="ãƒ¡ãƒ¼ãƒ«ã®æœ¬æ–‡å†…å®¹")
    sender: str = dspy.InputField(desc="é€ä¿¡è€…æƒ…å ±")

    email_type: EmailType = dspy.OutputField(desc="åˆ†é¡ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ç¨®åˆ¥")
    urgency: UrgencyLevel = dspy.OutputField(desc="ãƒ¡ãƒ¼ãƒ«ã®ç·Šæ€¥åº¦ãƒ¬ãƒ™ãƒ«")
    reasoning: str = dspy.OutputField(desc="åˆ†é¡ã®æ ¹æ‹ ã¨ãªã‚‹ç°¡æ½”ãªèª¬æ˜")

class ExtractEntities(dspy.Signature):
    """ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã‹ã‚‰ä¸»è¦ãªã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã€‚"""

    email_content: str = dspy.InputField(desc="ä»¶åã¨æœ¬æ–‡ã‚’å«ã‚€ãƒ¡ãƒ¼ãƒ«ã®å…¨æ–‡å†…å®¹")
    email_type: EmailType = dspy.InputField(desc="åˆ†é¡æ¸ˆã¿ã®ãƒ¡ãƒ¼ãƒ«ç¨®åˆ¥")

    key_entities: list[ExtractedEntity] = dspy.OutputField(desc="æŠ½å‡ºã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒªã‚¹ãƒˆï¼ˆç¨®åˆ¥ãƒ»å€¤ãƒ»ä¿¡é ¼åº¦ã‚’å«ã‚€ï¼‰")
    financial_amount: Optional[float] = dspy.OutputField(desc="è¨˜è¼‰ã•ã‚ŒãŸé‡‘é¡æƒ…å ±ï¼ˆä¾‹ï¼š'$99.99'ï¼‰")
    important_dates: list[str] = dspy.OutputField(desc="ãƒ¡ãƒ¼ãƒ«å†…ã§è¨€åŠã•ã‚Œã¦ã„ã‚‹é‡è¦ãªæ—¥ä»˜ãƒªã‚¹ãƒˆ")
    contact_info: list[str] = dspy.OutputField(desc="æŠ½å‡ºã•ã‚ŒãŸé–¢é€£é€£çµ¡å…ˆæƒ…å ±")

class GenerateActionItems(dspy.Signature):
    """ãƒ¡ãƒ¼ãƒ«å†…å®¹ã¨æŠ½å‡ºæƒ…å ±ã«åŸºã¥ãã€å¿…è¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³é …ç›®ã‚’æ±ºå®šã™ã‚‹ã€‚"""

    email_type: EmailType = dspy.InputField()
    urgency: UrgencyLevel = dspy.InputField()
    email_summary: str = dspy.InputField(desc="ãƒ¡ãƒ¼ãƒ«å†…å®¹ã®ç°¡æ½”ãªè¦ç´„")
    extracted_entities: list[ExtractedEntity] = dspy.InputField(desc="ãƒ¡ãƒ¼ãƒ«å†…ã§æ¤œå‡ºã•ã‚ŒãŸä¸»è¦ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£")

    action_required: bool = dspy.OutputField(desc="ä½•ã‚‰ã‹ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã‹ã©ã†ã‹")
    action_items: list[str] = dspy.OutputField(desc="å®Ÿæ–½ã™ã¹ãå…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³é …ç›®ãƒªã‚¹ãƒˆ")
    deadline: Optional[str] = dspy.OutputField(desc="è©²å½“ã™ã‚‹å ´åˆã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æœŸé™")
    priority_score: int = dspy.OutputField(desc="1ï½10æ®µéšã§ç¤ºã™å„ªå…ˆåº¦ã‚¹ã‚³ã‚¢")

class SummarizeEmail(dspy.Signature):
    """ãƒ¡ãƒ¼ãƒ«å†…å®¹ã®è¦ç‚¹ã‚’ç°¡æ½”ã«ã¾ã¨ã‚ãŸè¦ç´„ã‚’ä½œæˆã™ã‚‹ã€‚"""

    email_subject: str = dspy.InputField()
    email_body: str = dspy.InputField()
    key_entities: list[ExtractedEntity] = dspy.InputField()

    summary: str = dspy.OutputField(desc="ãƒ¡ãƒ¼ãƒ«ã®ä¸»è¦ãƒã‚¤ãƒ³ãƒˆã‚’2ï½3æ–‡ã§ã¾ã¨ã‚ãŸè¦ç´„")
```

## ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ¡ãƒ¼ãƒ«å‡¦ç†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ§‹ç¯‰

æ¬¡ã«ã€ãƒ¡ã‚¤ãƒ³ã¨ãªã‚‹ãƒ¡ãƒ¼ãƒ«å‡¦ç†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼š

```python
class EmailProcessor(dspy.Module):
    """DSPyãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æ´»ç”¨ã—ãŸåŒ…æ‹¬çš„ãªé›»å­ãƒ¡ãƒ¼ãƒ«å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self):
        super().__init__()

        # å‡¦ç†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆæœŸåŒ–
        self.classifier = dspy.ChainOfThought(ClassifyEmail)
        self.entity_extractor = dspy.ChainOfThought(ExtractEntities)
        self.action_generator = dspy.ChainOfThought(GenerateActionItems)
        self.summarizer = dspy.ChainOfThought(SummarizeEmail)

    def forward(self, email_subject: str, email_body: str, sender: str = ""):
        """é›»å­ãƒ¡ãƒ¼ãƒ«ã‚’å‡¦ç†ã—ã€æ§‹é€ åŒ–ã•ã‚ŒãŸæƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹"""

        # ã‚¹ãƒ†ãƒƒãƒ—1: é›»å­ãƒ¡ãƒ¼ãƒ«ã®åˆ†é¡
        classification = self.classifier(
            email_subject=email_subject,
            email_body=email_body,
            sender=sender
        )

        # ã‚¹ãƒ†ãƒƒãƒ—2: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æŠ½å‡º
        full_content = f"ä»¶å: {email_subject}\n\né€ä¿¡å…ƒ: {sender}\n\n{email_body}"
        entities = self.entity_extractor(
            email_content=full_content,
            email_type=classification.email_type
        )

        # ã‚¹ãƒ†ãƒƒãƒ—3: è¦ç´„ç”Ÿæˆ
        summary = self.summarizer(
            email_subject=email_subject,
            email_body=email_body,
            key_entities=entities.key_entities
        )

        # ã‚¹ãƒ†ãƒƒãƒ—4: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®æ±ºå®š
        actions = self.action_generator(
            email_type=classification.email_type,
            urgency=classification.urgency,
            email_summary=summary.summary,
            extracted_entities=entities.key_entities
        )

        # ã‚¹ãƒ†ãƒƒãƒ—5: çµæœã®æ§‹é€ åŒ–
        return dspy.Prediction(
            email_type=classification.email_type,
            urgency=classification.urgency,
            summary=summary.summary,
            key_entities=entities.key_entities,
            financial_amount=entities.financial_amount,
            important_dates=entities.important_dates,
            action_required=actions.action_required,
            action_items=actions.action_items,
            deadline=actions.deadline,
            priority_score=actions.priority_score,
            reasoning=classification.reasoning,
            contact_info=entities.contact_info
        )
```

## ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ¡ãƒ¼ãƒ«å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè¡Œ

ãƒ¡ãƒ¼ãƒ«å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ç°¡å˜ãªé–¢æ•°ã‚’ä½œæˆã—ã¾ã™ï¼š

```python
import os
def run_email_processing_demo():
    """ãƒ¡ãƒ¼ãƒ«å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"""
    
    # DSPyã®è¨­å®š
    lm = dspy.LM(model='openai/gpt-4o-mini')
    dspy.configure(lm=lm)
    os.environ["OPENAI_API_KEY"] = "<YOUR OPENAI KEY>"
    
    # ãƒ¡ãƒ¼ãƒ«å‡¦ç†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä½œæˆ
    processor = EmailProcessor()
    
    # ãƒ†ã‚¹ãƒˆç”¨ã‚µãƒ³ãƒ—ãƒ«ãƒ¡ãƒ¼ãƒ«
    sample_emails = [
        {
            "subject": "ã”æ³¨æ–‡ç¢ºèª #12345 - MacBook Pro ç™ºé€ã®ã”æ¡ˆå†…",
            "body": """æ‹å•“ ã‚¹ãƒŸã‚¹æ§˜

ã“ã®ãŸã³ã¯ã”æ³¨æ–‡èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ã”æ³¨æ–‡ç•ªå· #12345 ã®å‡¦ç†ãŒå®Œäº†ã„ãŸã—ã¾ã—ãŸã®ã§ãŠçŸ¥ã‚‰ã›ã„ãŸã—ã¾ã™ã€‚

ã”æ³¨æ–‡å†…å®¹:
- MacBook Pro 14ã‚¤ãƒ³ãƒï¼ˆã‚¹ãƒšãƒ¼ã‚¹ã‚°ãƒ¬ã‚¤ï¼‰
- åˆè¨ˆé‡‘é¡: 2,399.00ãƒ‰ãƒ«
- ç™ºé€äºˆå®š: 2024å¹´12æœˆ15æ—¥
- è¿½è·¡ç•ªå·: 1Z999AA1234567890

ã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€support@techstore.com ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚

æ•¬å…·
TechStore ãƒãƒ¼ãƒ """,
            "sender": "orders@techstore.com"
        },
        {
            "subject": "ç·Šæ€¥: ã‚µãƒ¼ãƒãƒ¼éšœå®³ç™ºç”Ÿ - è‡³æ€¥å¯¾å¿œãŒå¿…è¦ã§ã™",
            "body": """DevOpsãƒãƒ¼ãƒ å„ä½

ç¾åœ¨ã€æœ¬ç•ªç’°å¢ƒã«å½±éŸ¿ã‚’ä¸ãˆã‚‹é‡å¤§ãªã‚µãƒ¼ãƒãƒ¼éšœå®³ãŒç™ºç”Ÿã—ã¦ãŠã‚Šã¾ã™ã€‚

å½±éŸ¿ç¯„å›²: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ä¸èƒ½
ç™ºç”Ÿæ™‚åˆ»: EST 14:30

ç›´ã¡ã«ç·Šæ€¥é€£çµ¡ä¼šè­°ã«ã”å‚åŠ ãã ã•ã„: +1-555-123-4567

æœ€å„ªå…ˆäº‹é …ã¨ã—ã¦ã”å¯¾å¿œãã ã•ã„ã€‚

ã‚ˆã‚ã—ããŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™ã€‚
ã‚µã‚¤ãƒˆä¿¡é ¼æ€§ãƒãƒ¼ãƒ """,
            "sender": "alerts@company.com"
        },
        {
            "subject": "ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ¡ˆå†…: Q4è¨ˆç”»ç­–å®šã‚»ãƒƒã‚·ãƒ§ãƒ³",
            "body": """ãƒãƒ¼ãƒ å„ä½

Q4è¨ˆç”»ç­–å®šãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¸ã®ã”å‚åŠ ã‚’ã”æ¡ˆå†…ã„ãŸã—ã¾ã™ã€‚

æ—¥æ™‚: 2024å¹´12æœˆ20æ—¥ï¼ˆé‡‘ï¼‰14:00ï½16:00 EST
å ´æ‰€: ä¼šè­°å®¤A

12æœˆ18æ—¥ã¾ã§ã«å‚åŠ å¯å¦ã‚’ã”è¿”ä¿¡ãã ã•ã„ã€‚

ã‚ˆã‚ã—ããŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™ã€‚
ã‚µãƒ©ãƒ»ã‚¸ãƒ§ãƒ³ã‚½ãƒ³""",
            "sender": "sarah.johnson@company.com"
        }
    ]
    
    # å„ãƒ¡ãƒ¼ãƒ«ã‚’å‡¦ç†ã—çµæœã‚’è¡¨ç¤º
    print("ğŸš€ ãƒ¡ãƒ¼ãƒ«å‡¦ç†ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³")
    print("=" * 50)
    
    for i, email in enumerate(sample_emails):
        print(f"\nğŸ“§ ãƒ¡ãƒ¼ãƒ« {i+1}: {email['subject'][:50]}...")
        
        # ãƒ¡ãƒ¼ãƒ«å‡¦ç†ã®å®Ÿè¡Œ
        result = processor(
            email_subject=email["subject"],
            email_body=email["body"],
            sender=email["sender"]
        )
        
        # ä¸»è¦çµæœã®è¡¨ç¤º
        print(f"   ğŸ“Š ç¨®åˆ¥: {result.email_type}")
        print(f"   ğŸš¨ ç·Šæ€¥åº¦: {result.urgency}")
        print(f"   ğŸ“ è¦ç´„: {result.summary}")
        
        if result.financial_amount:
            print(f"   ğŸ’° é‡‘é¡: ${result.financial_amount:,.2f}")
        
        if result.action_required:
            print(f"   âœ… å¯¾å¿œè¦: ã‚ã‚Š")
            if result.deadline:
                print(f"   â° æœŸé™: {result.deadline}")
        else:
            print(f"   âœ… å¯¾å¿œè¦: ãªã—")

# ãƒ‡ãƒ¢ã®å®Ÿè¡Œ
if __name__ == "__main__":
    run_email_processing_demo()
```

## æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›çµæœ
```
ğŸš€ ãƒ¡ãƒ¼ãƒ«å‡¦ç†ãƒ‡ãƒ¢
==================================================

ğŸ“§ ãƒ¡ãƒ¼ãƒ« 1: æ³¨æ–‡ç¢ºèª #12345 - MacBook Pro ã®ç™ºé€æº–å‚™å®Œäº†...
   ğŸ“Š ç¨®åˆ¥: order_confirmation
   ğŸš¨ ç·Šæ€¥åº¦: ä½
   ğŸ“ æ¦‚è¦: æœ¬ãƒ¡ãƒ¼ãƒ«ã¯ã€John Smith æ§˜ã®æ³¨æ–‡ç•ªå· #12345 ã«é–¢ã™ã‚‹ç¢ºèªé€šçŸ¥ã§ã™ã€‚Space Gray ã‚«ãƒ©ãƒ¼ã® MacBook Pro 14ã‚¤ãƒ³ãƒã‚’ç·é¡ $2,399.00 ã§å—æ³¨ã„ãŸã—ã¾ã—ãŸã€‚ç™ºé€äºˆå®šæ—¥ã¯ 2024å¹´12æœˆ15æ—¥ã§ã™ã€‚è¿½è·¡ç•ªå·ã¨ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆçª“å£ã®é€£çµ¡å…ˆã‚’è¨˜è¼‰ã—ã¦ãŠã‚Šã¾ã™ã€‚
   ğŸ’° é‡‘é¡: $2,399.00
   âœ… å¯¾å¿œè¦å¦: ä¸è¦

ğŸ“§ ãƒ¡ãƒ¼ãƒ« 2: ç·Šæ€¥: ã‚µãƒ¼ãƒãƒ¼éšœå®³ç™ºç”Ÿ - è‡³æ€¥ã”å¯¾å¿œãã ã•ã„...
   ğŸ“Š ç¨®åˆ¥: other
   ğŸš¨ ç·Šæ€¥åº¦: é‡å¤§
   ğŸ“ æ¦‚è¦: ã‚µã‚¤ãƒˆä¿¡é ¼æ€§ãƒãƒ¼ãƒ ã‚ˆã‚Šã€ç±³å›½æ±éƒ¨æ¨™æº–æ™‚åˆå¾Œ2æ™‚30åˆ†ã«ç™ºç”Ÿã—ãŸé‡å¤§ãªã‚µãƒ¼ãƒãƒ¼éšœå®³ã«ã¤ã„ã¦å ±å‘ŠãŒã‚ã‚Šã¾ã—ãŸã€‚ã“ã®éšœå®³ã«ã‚ˆã‚Šå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„çŠ¶æ…‹ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚DevOpsãƒãƒ¼ãƒ ã«ã¯ç›´ã¡ã«ç·Šæ€¥ä¼šè­°ã«ã”å‚åŠ ã„ãŸã ãã€æœ¬å•é¡Œã®è§£æ±ºã«ã”å”åŠ›ãã ã•ã„ã¾ã™ã‚ˆã†ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚
   âœ… å¯¾å¿œè¦å¦: å¿…è¦
   â° æœŸé™: å³æ™‚

ğŸ“§ ãƒ¡ãƒ¼ãƒ« 3: ä¼šè­°æ¡ˆå†…: Q4 äº‹æ¥­è¨ˆç”»ç­–å®šãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°...
   ğŸ“Š ç¨®åˆ¥: meeting_invitation
   ğŸš¨ ç·Šæ€¥åº¦: ä¸­
   ğŸ“ æ¦‚è¦: Sarah Johnson ã‚ˆã‚Šã€2024å¹´12æœˆ20æ—¥ ç±³å›½æ±éƒ¨æ¨™æº–æ™‚åˆå¾Œ2æ™‚ã‹ã‚‰4æ™‚ã¾ã§ã€ä¼šè­°å®¤Aã«ã¦ Q4 äº‹æ¥­è¨ˆç”»ç­–å®šãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’é–‹å‚¬ã„ãŸã—ã¾ã™ã€‚ã”å‚åŠ äºˆå®šã®æ–¹ã¯12æœˆ18æ—¥ã¾ã§ã«å‡ºæ¬ ã®ã”é€£çµ¡ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚
   âœ… å¯¾å¿œè¦å¦: å¿…è¦
   â° æœŸé™: 12æœˆ18æ—¥
```

## ä»Šå¾Œã®å±•é–‹

- **ãƒ¡ãƒ¼ãƒ«ç¨®åˆ¥ã®è¿½åŠ åˆ†é¡**ï¼ˆãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼ã€ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ¼ãƒ«ãªã©ï¼‰ã®å®Ÿè£…ã¨ç²¾åº¦å‘ä¸Š
- **ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ã¨ã®é€£æº**ï¼ˆGmail APIã€Outlookã€IMAPãªã©ï¼‰ã®å®Ÿç¾
- **å„ç¨®LLMã®æ¯”è¼ƒæ¤œè¨**ã¨æœ€é©åŒ–æ‰‹æ³•ã®æ¤œè¨¼
- **å¤šè¨€èªå¯¾å¿œæ©Ÿèƒ½**ã®è¿½åŠ ã«ã‚ˆã‚‹å›½éš›ãƒ¡ãƒ¼ãƒ«å‡¦ç†ã®å®Ÿç¾
- **ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ€§èƒ½ã®æœ€é©åŒ–**ã«ã‚ˆã‚‹å‡¦ç†é€Ÿåº¦ã®å‘ä¸Š
